"""Example runtime config.

Copy to conf/config.py only if you do not want to use the repository default.
Production deployments should prefer URL_CHECK_* environment variables.
"""

import os


def _env_str(name, default=""):
    value = os.getenv(name)
    if value is None:
        return default
    value = value.strip()
    return value if value else default


def _env_bool(name, default=False):
    value = os.getenv(name)
    if value is None:
        return default
    return value.strip().lower() in {"1", "true", "yes", "on"}


def _env_int(name, default=0):
    value = os.getenv(name)
    if value is None:
        return default
    try:
        return int(value.strip())
    except Exception:
        return default


def _env_list(name, default=None):
    if default is None:
        default = []
    value = os.getenv(name)
    if value is None:
        return default
    items = [x.strip() for x in value.split(",") if x.strip()]
    return items if items else default


mail_conf = "conf/mail.ini"
tasks_yaml = "conf/tasks.yaml"

send_to = _env_list("URL_CHECK_MAIL_RECEIVERS", ["ops@example.com"])
history_datat_day = _env_int("URL_CHECK_HISTORY_DATA_DAYS", 3)

enable_alerts = _env_bool("URL_CHECK_ENABLE_ALERTS", True)
enable_dingding = _env_bool("URL_CHECK_ENABLE_DINGDING", True)
enable_mail = _env_bool("URL_CHECK_ENABLE_MAIL", False)

dingding_url = _env_str("URL_CHECK_DINGDING_WEBHOOK", "https://oapi.dingtalk.com/robot/send?")
access_token = _env_str("URL_CHECK_DINGDING_ACCESS_TOKEN", "")

alert_log_enabled = _env_bool("URL_CHECK_ALERT_LOG_ENABLED", True)
alert_log_retention_days = _env_int("URL_CHECK_ALERT_LOG_RETENTION_DAYS", 30)

report_enabled = _env_bool("URL_CHECK_REPORT_ENABLED", True)
report_interval_hours = _env_int("URL_CHECK_REPORT_INTERVAL_HOURS", 2)
report_dingding_enabled = _env_bool("URL_CHECK_REPORT_DINGDING_ENABLED", True)
report_mail_enabled = _env_bool("URL_CHECK_REPORT_MAIL_ENABLED", False)

# Optional strict mode:
# when true, missing required vars for enabled channels will fail fast.
strict_config = _env_bool("URL_CHECK_STRICT_CONFIG", False)
