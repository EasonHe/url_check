# tasks.yaml 示例
#
# 使用建议：
# 1) 最先启用「最小可用模板」验证链路。
# 2) 再启用「生产推荐模板」覆盖核心能力。
# 3) 联调模板仅用于告警验证，不建议长期留在生产配置。

tasks:
  # ---------------------------------------------------------------------------
  # A. 最小可用模板（Minimal）
  # ---------------------------------------------------------------------------
  - name: minimal-health
    method: get
    url: https://httpbin.org/get
    timeout: 10
    interval: 60
    threshold:
      stat_code: 200

  # ---------------------------------------------------------------------------
  # B. 生产推荐模板（Production）
  # ---------------------------------------------------------------------------
  - name: production-homepage
    method: get
    url: https://httpbin.org/get
    timeout: 10
    interval: 60
    threshold:
      stat_code: 200
      delay: 1000
      math_str: "url"
    ssl:
      verify: true
      warning_days: 30
    retry:
      count: 2
      delay: 1

  - name: production-json-health
    method: get
    url: https://httpbin.org/json
    timeout: 10
    interval: 60
    threshold:
      stat_code: 200
    expect_json: true
    json_path: "$.slideshow.author"
    json_path_value: "Yours Truly"
    ssl:
      verify: true
      warning_days: 30

  - name: production-post-api
    method: post
    url: https://httpbin.org/post
    timeout: 10
    interval: 120
    headers:
      Content-Type: application/json
    payload: '{"name":"url-check"}'
    threshold:
      stat_code: 200
      delay: 1500

  - name: production-via-proxy
    method: get
    url: https://httpbin.org/get
    timeout: 10
    interval: 120
    threshold:
      stat_code: 200
      delay: 2000
    # 代理地址示例：
    # - 本机运行：proxy: http://127.0.0.1:7890
    # - 容器运行：proxy: http://__HOST__:7890（自动替换为 host.docker.internal）
    proxy: http://__HOST__:7890
    ssl:
      verify: true
      warning_days: 30

  # ---------------------------------------------------------------------------
  # C. 联调模板（Debug，仅用于验证告警）
  # ---------------------------------------------------------------------------
  - name: debug-keyword-alert
    method: get
    url: https://httpbin.org/json
    timeout: 10
    interval: 30
    threshold:
      stat_code: 200
      # 故意配置不存在关键字，用于验证 content_match 告警
      math_str: "NON_EXISTENT_KEYWORD_XYZ"

  - name: debug-jsonpath-alert
    method: get
    url: https://httpbin.org/json
    timeout: 10
    interval: 30
    threshold:
      stat_code: 200
    expect_json: true
    json_path: "$.slideshow.author"
    # 故意配置错误值，用于验证 json_path 告警
    json_path_value: "WRONG_AUTHOR_NAME"

  - name: debug-timeout-alert
    method: get
    url: https://httpbin.org/delay/10
    timeout: 3
    interval: 30
    threshold:
      stat_code: 200

  - name: debug-delay-alert
    method: get
    url: https://httpbin.org/delay/2
    timeout: 10
    interval: 30
    threshold:
      stat_code: 200
      delay: 300
