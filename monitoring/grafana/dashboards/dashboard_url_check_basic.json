{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "id": 901,
      "type": "row",
      "title": "① 总览 / Overview",
      "gridPos": {
        "x": 0,
        "y": 0,
        "w": 24,
        "h": 1
      },
      "collapsed": false,
      "panels": []
    },
    {
      "id": 201,
      "type": "stat",
      "title": "全局检查成功率（5m） / Global Check Success Rate (5m)",
      "description": "基于 url_check_task_checks_total 计算最近 5 分钟成功率，避免告警空样本造成无数据。",
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "gridPos": {
        "x": 0,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "refId": "A",
          "expr": "100 * sum(increase(url_check_task_checks_total{task_name=~\"$task\",result=\"success\"}[5m])) / clamp_min(sum(increase(url_check_task_checks_total{task_name=~\"$task\"}[5m])), 1)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 2,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 95
              },
              {
                "color": "green",
                "value": 99
              }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto"
      }
    },
    {
      "id": 202,
      "type": "stat",
      "title": "当前失败任务数（全维度） / Current Failed Tasks (All Reasons)",
      "description": "按状态码/超时/关键字/JSON/SSL 告警态去重统计当前失败任务数。",
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "gridPos": {
        "x": 6,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(clamp_max(url_check_status_code_alert{task_name=~\"$task\"} + url_check_timeout_alert{task_name=~\"$task\"} + url_check_content_alert{task_name=~\"$task\"} + url_check_json_path_alert{task_name=~\"$task\"} + url_check_ssl_expiry_alert{task_name=~\"$task\"}, 1))"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "decimals": 0,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto"
      }
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "id": 102,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "count(url_check_status_code_alert{task_name=~\"$task\"} == 1)",
          "legendFormat": "",
          "refId": "A"
        }
      ],
      "title": "状态码不匹配任务数 / Status Code Mismatch Tasks",
      "type": "stat",
      "description": "状态码与任务阈值不匹配的任务数量 / Number of tasks whose status code mismatches configured threshold."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 18,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "id": 103,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "count(url_check_timeout_alert{task_name=~\"$task\"} == 1)",
          "legendFormat": "",
          "refId": "A"
        }
      ],
      "title": "超时告警任务数 / Timeout Alert Tasks",
      "type": "stat",
      "description": "当前处于超时告警态的任务数量。"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 5,
        "w": 8,
        "h": 4
      },
      "id": 101,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "max(url_check_scheduler_job_count)",
          "legendFormat": "",
          "refId": "A"
        }
      ],
      "title": "调度任务总数 / Scheduler Job Count",
      "type": "stat",
      "description": "调度器当前加载任务数（全局）。"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "green",
                "value": 1
              },
              {
                "color": "red",
                "value": 0.1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 8,
        "y": 5,
        "w": 8,
        "h": 4
      },
      "id": 104,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "max(url_check_scheduler_up)",
          "legendFormat": "",
          "refId": "A"
        }
      ],
      "title": "调度器状态 / Scheduler Up",
      "type": "stat",
      "description": "调度器运行状态：1=运行，0=停止。"
    },
    {
      "id": 204,
      "type": "bargauge",
      "title": "最近30分钟失败原因分布 / Failure Reasons (30m)",
      "description": "基于失败分类计数器统计最近 30 分钟失败原因。",
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "gridPos": {
        "x": 16,
        "y": 5,
        "w": 8,
        "h": 4
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum by (reason) (increase(url_check_task_failures_total{task_name=~\"$task\"}[30m]))",
          "legendFormat": "{{reason}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 1
              },
              {
                "color": "red",
                "value": 3
              }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showUnfilled": true
      }
    },
    {
      "id": 203,
      "type": "timeseries",
      "title": "按任务检查成功率（5m） / Success Rate by Task (5m)",
      "description": "按任务维度统计最近 5 分钟成功率。",
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "gridPos": {
        "x": 0,
        "y": 9,
        "w": 24,
        "h": 8
      },
      "targets": [
        {
          "refId": "A",
          "expr": "100 * sum by (task_name) (increase(url_check_task_checks_total{task_name=~\"$task\",result=\"success\"}[5m])) / clamp_min(sum by (task_name) (increase(url_check_task_checks_total{task_name=~\"$task\"}[5m])), 1)",
          "legendFormat": "{{task_name}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 0,
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 95
              },
              {
                "color": "green",
                "value": 99
              }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      }
    },
    {
      "id": 902,
      "type": "row",
      "title": "② 快速定位 / Diagnosis",
      "gridPos": {
        "x": 0,
        "y": 17,
        "w": 24,
        "h": 1
      },
      "collapsed": false,
      "panels": []
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 18,
        "w": 12,
        "h": 8
      },
      "id": 1,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "url_check_http_status_code{task_name=~\"$task\"}",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "各任务 HTTP 状态码 / HTTP Status Code by Task",
      "type": "timeseries",
      "description": "展示每个任务最近采集到的 HTTP 状态码 / Latest HTTP status code per task."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 18,
        "w": 12,
        "h": 8
      },
      "id": 2,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (task_name) (increase(url_check_task_failures_total{task_name=~\"$task\",reason=\"timeout\"}[5m]))",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "5分钟超时失败次数 / Timeout Failures (5m)",
      "type": "timeseries",
      "description": "按任务统计最近 5 分钟超时失败累计次数。"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "unit": "ms"
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 26,
        "w": 12,
        "h": 9
      },
      "id": 7,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "topk(5, histogram_quantile(0.95, sum by (le, task_name) (rate(url_check_http_response_time_ms_bucket{task_name=~\"$task\"}[5m]))))",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "慢任务 Top5（P95） / Top5 Slow Tasks by P95",
      "type": "timeseries",
      "description": "响应时间 P95 最高的前 5 个任务 / Top 5 tasks with highest P95 response time."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 26,
        "w": 12,
        "h": 9
      },
      "id": 8,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "topk(5, sum by (task_name) (increase(url_check_task_failures_total{task_name=~\"$task\",reason=\"timeout\"}[30m])))",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "超时失败 Top5（30m） / Top5 Timeout Failures (30m)",
      "type": "timeseries",
      "description": "最近 30 分钟超时失败最多的 5 个任务。"
    },
    {
      "id": 903,
      "type": "row",
      "title": "③ 深入分析 / Analysis",
      "gridPos": {
        "x": 0,
        "y": 35,
        "w": 24,
        "h": 1
      },
      "collapsed": false,
      "panels": []
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "unit": "ms"
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 36,
        "w": 12,
        "h": 8
      },
      "id": 3,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le, task_name) (rate(url_check_http_response_time_ms_bucket{task_name=~\"$task\"}[5m])))",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "响应时间 P95（毫秒） / Response Time P95 (ms)",
      "type": "timeseries",
      "description": "按任务统计最近 5 分钟响应时间的 P95 / P95 response time by task in last 5 minutes."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "unit": "suffix: 天",
          "decimals": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 7
              },
              {
                "color": "green",
                "value": 30
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 36,
        "w": 12,
        "h": 8
      },
      "id": 5,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "refId": "A",
          "expr": "url_check_ssl_expiry_days{task_name=~\"$task\"}",
          "legendFormat": "{{task_name}}"
        }
      ],
      "title": "SSL 证书剩余天数 / SSL Expiry Days",
      "type": "timeseries",
      "description": "按任务展示 SSL 证书剩余有效天数。"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "green",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 44,
        "w": 12,
        "h": 8
      },
      "id": 4,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "url_check_content_match{task_name=~\"$task\"}",
          "legendFormat": "关键字/Content {{task_name}}",
          "refId": "A"
        },
        {
          "expr": "url_check_json_valid{task_name=~\"$task\"}",
          "legendFormat": "JSON有效/Valid {{task_name}}",
          "refId": "B"
        },
        {
          "expr": "url_check_json_path_match{task_name=~\"$task\"}",
          "legendFormat": "JSON路径/Path {{task_name}}",
          "refId": "C"
        }
      ],
      "title": "关键字/JSON 匹配状态（0=失败，1=成功） / Content & JSON Match State (0=fail,1=ok)",
      "type": "timeseries",
      "description": "0 表示校验失败，1 表示校验成功 / 0 means failed check, 1 means pass."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 44,
        "w": 12,
        "h": 8
      },
      "id": 6,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum by (task_name) (rate(url_check_task_checks_total{task_name=~\"$task\",result=\"success\"}[5m]))",
          "legendFormat": "{{task_name}} success"
        },
        {
          "refId": "B",
          "expr": "sum by (task_name) (rate(url_check_task_checks_total{task_name=~\"$task\",result=\"failed\"}[5m]))",
          "legendFormat": "{{task_name}} failed"
        }
      ],
      "title": "任务检查速率（成功/失败） / Check Throughput by Result (5m)",
      "type": "timeseries",
      "description": "按任务展示检查速率，区分成功与失败。"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 52,
        "w": 24,
        "h": 8
      },
      "id": 9,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sort_desc(time() - timestamp(url_check_http_status_code{task_name=~\"$task\"}))",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "数据新鲜度（秒） / Data Freshness (s)",
      "type": "timeseries",
      "description": "当前时刻到该任务最近一次指标更新时间的间隔 / Seconds since last metric update per task."
    }
  ],
  "refresh": "15s",
  "schemaVersion": 39,
  "style": "dark",
  "tags": [
    "url-check",
    "prometheus",
    "中文",
    "增强版",
    "enhanced"
  ],
  "templating": {
    "list": [
      {
        "name": "task",
        "label": "任务 / Task",
        "type": "query",
        "datasource": {
          "type": "prometheus",
          "uid": "prometheus"
        },
        "definition": "label_values(url_check_http_status_code, task_name)",
        "query": {
          "query": "label_values(url_check_http_status_code, task_name)",
          "refId": "PrometheusVariableQueryEditor-Task"
        },
        "includeAll": true,
        "multi": true,
        "allValue": ".*",
        "current": {
          "selected": true,
          "text": [
            "All"
          ],
          "value": [
            "$__all"
          ]
        },
        "refresh": 2,
        "sort": 1
      }
    ]
  },
  "time": {
    "from": "now-30m",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "URL 检查监控总览 / URL Check Monitoring Overview (Enhanced)",
  "uid": "url-check-basic",
  "version": 4,
  "weekStart": ""
}
