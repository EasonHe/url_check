{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "id": 901,
      "type": "row",
      "title": "① 总览 / Overview",
      "gridPos": {
        "x": 0,
        "y": 0,
        "w": 24,
        "h": 1
      },
      "collapsed": false,
      "panels": []
    },
    {
      "id": 201,
      "type": "stat",
      "title": "全局拨测成功率 / Global Probe Success Rate",
      "description": "拨测失败定义：状态码不匹配或超时。1 个任务失败记为 0%，正常记为 100%。",
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "gridPos": {
        "x": 0,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "refId": "A",
          "expr": "100 * avg(1 - clamp_max(url_check_status_code_alert{task_name=~\"$task\"} + url_check_timeout_alert{task_name=~\"$task\"}, 1))"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 2,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 95
              },
              {
                "color": "green",
                "value": 99
              }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto"
      }
    },
    {
      "id": 202,
      "type": "stat",
      "title": "当前拨测失败任务数 / Current Failed Tasks",
      "description": "失败任务 = 状态码不匹配 或 超时（去重后计数）。",
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "gridPos": {
        "x": 6,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(clamp_max(url_check_status_code_alert{task_name=~\"$task\"} + url_check_timeout_alert{task_name=~\"$task\"}, 1))"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "decimals": 0,
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "orientation": "auto",
        "textMode": "auto",
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto"
      }
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "id": 102,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "count(url_check_status_code_alert{task_name=~\"$task\"} == 1)",
          "legendFormat": "",
          "refId": "A"
        }
      ],
      "title": "状态码不匹配任务数 / Status Code Mismatch Tasks",
      "type": "stat",
      "description": "状态码与任务阈值不匹配的任务数量 / Number of tasks whose status code mismatches configured threshold."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 18,
        "y": 1,
        "w": 6,
        "h": 4
      },
      "id": 103,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "count((url_check_http_timeout_total{task_name=~\"$task\"}) > 0)",
          "legendFormat": "",
          "refId": "A"
        }
      ],
      "title": "超时任务数 / Timeout Tasks",
      "type": "stat",
      "description": "出现过超时的任务数量 / Tasks with timeout occurrences."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 5,
        "w": 8,
        "h": 4
      },
      "id": 101,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "count(url_check_http_status_code{task_name=~\"$task\"})",
          "legendFormat": "",
          "refId": "A"
        }
      ],
      "title": "任务总数 / Total Tasks",
      "type": "stat",
      "description": "当前被采集到的任务数量 / Number of tasks currently scraped."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 0.01
              },
              {
                "color": "red",
                "value": 0.1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 8,
        "y": 5,
        "w": 8,
        "h": 4
      },
      "id": 104,
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(rate(url_check_http_timeout_total{task_name=~\"$task\"}[5m]))",
          "legendFormat": "",
          "refId": "A"
        }
      ],
      "title": "5分钟超时增长速率（次/秒，总览） / Timeout Growth Rate (5m, per second, Overview)",
      "type": "stat",
      "description": "基于 rate(url_check_http_timeout_total[5m])，表示超时计数器每秒增长量，不是5分钟总次数。"
    },
    {
      "id": 204,
      "type": "bargauge",
      "title": "失败原因拆分 / Failure Reason Breakdown",
      "description": "按当前任务状态统计失败原因数量。",
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "gridPos": {
        "x": 16,
        "y": 5,
        "w": 8,
        "h": 4
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(url_check_timeout_alert{task_name=~\"$task\"})",
          "legendFormat": "超时 / Timeout"
        },
        {
          "refId": "B",
          "expr": "sum(url_check_status_code_alert{task_name=~\"$task\"})",
          "legendFormat": "状态码不匹配 / Status Mismatch"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 1
              },
              {
                "color": "red",
                "value": 3
              }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showUnfilled": true
      }
    },
    {
      "id": 203,
      "type": "timeseries",
      "title": "按任务拨测成功率（%） / Probe Success Rate by Task",
      "description": "每个任务实时成功率：100%（成功）或 0%（失败）。失败定义同上。",
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "gridPos": {
        "x": 0,
        "y": 9,
        "w": 24,
        "h": 8
      },
      "targets": [
        {
          "refId": "A",
          "expr": "100 * (1 - clamp_max(url_check_status_code_alert{task_name=~\"$task\"} + url_check_timeout_alert{task_name=~\"$task\"}, 1))",
          "legendFormat": "{{task_name}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 0,
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 95
              },
              {
                "color": "green",
                "value": 99
              }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      }
    },
    {
      "id": 902,
      "type": "row",
      "title": "② 快速定位 / Diagnosis",
      "gridPos": {
        "x": 0,
        "y": 17,
        "w": 24,
        "h": 1
      },
      "collapsed": false,
      "panels": []
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 18,
        "w": 12,
        "h": 8
      },
      "id": 1,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "url_check_http_status_code{task_name=~\"$task\"}",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "各任务 HTTP 状态码 / HTTP Status Code by Task",
      "type": "timeseries",
      "description": "展示每个任务最近采集到的 HTTP 状态码 / Latest HTTP status code per task."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 18,
        "w": 12,
        "h": 8
      },
      "id": 2,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "rate(url_check_http_timeout_total{task_name=~\"$task\"}[5m])",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "5分钟超时增长速率（次/秒） / Timeout Growth Rate (5m, per second)",
      "type": "timeseries",
      "description": "基于 rate(url_check_http_timeout_total[5m])，表示超时计数器每秒增长量，不是5分钟总次数。"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "unit": "ms"
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 26,
        "w": 12,
        "h": 9
      },
      "id": 7,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "topk(5, histogram_quantile(0.95, sum by (le, task_name) (rate(url_check_http_response_time_ms_bucket{task_name=~\"$task\"}[5m]))))",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "慢任务 Top5（P95） / Top5 Slow Tasks by P95",
      "type": "timeseries",
      "description": "响应时间 P95 最高的前 5 个任务 / Top 5 tasks with highest P95 response time."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 26,
        "w": 12,
        "h": 9
      },
      "id": 8,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "topk(5, rate(url_check_http_timeout_total{task_name=~\"$task\"}[5m]))",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "超时任务 Top5 / Top5 Timeout Tasks",
      "type": "timeseries",
      "description": "超时速率最高的前 5 个任务 / Top 5 tasks by timeout increase rate."
    },
    {
      "id": 903,
      "type": "row",
      "title": "③ 深入分析 / Analysis",
      "gridPos": {
        "x": 0,
        "y": 35,
        "w": 24,
        "h": 1
      },
      "collapsed": false,
      "panels": []
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "unit": "ms"
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 36,
        "w": 12,
        "h": 8
      },
      "id": 3,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le, task_name) (rate(url_check_http_response_time_ms_bucket{task_name=~\"$task\"}[5m])))",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "响应时间 P95（毫秒） / Response Time P95 (ms)",
      "type": "timeseries",
      "description": "按任务统计最近 5 分钟响应时间的 P95 / P95 response time by task in last 5 minutes."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "unit": "suffix: 天",
          "decimals": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "yellow",
                "value": 7
              },
              {
                "color": "green",
                "value": 30
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 36,
        "w": 12,
        "h": 8
      },
      "id": 5,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "url_check_ssl_expiry_days{task_name=~\"$task\"}",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "SSL 证书剩余天数 / SSL Expiry Days",
      "type": "timeseries",
      "description": "当前任务证书距离过期的剩余天数 / Remaining certificate validity days by task."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "green",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 44,
        "w": 12,
        "h": 8
      },
      "id": 4,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "url_check_content_match{task_name=~\"$task\"}",
          "legendFormat": "关键字/Content {{task_name}}",
          "refId": "A"
        },
        {
          "expr": "url_check_json_valid{task_name=~\"$task\"}",
          "legendFormat": "JSON有效/Valid {{task_name}}",
          "refId": "B"
        },
        {
          "expr": "url_check_json_path_match{task_name=~\"$task\"}",
          "legendFormat": "JSON路径/Path {{task_name}}",
          "refId": "C"
        }
      ],
      "title": "关键字/JSON 匹配状态（0=失败，1=成功） / Content & JSON Match State (0=fail,1=ok)",
      "type": "timeseries",
      "description": "0 表示校验失败，1 表示校验成功 / 0 means failed check, 1 means pass."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          }
        },
        "overrides": []
      },
      "gridPos": {
        "x": 12,
        "y": 44,
        "w": 12,
        "h": 8
      },
      "id": 6,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "rate(url_check_success_total{task_name=~\"$task\"}[5m])",
          "legendFormat": "{{task_name}} 状态码/Code={{status_code}}",
          "refId": "A"
        }
      ],
      "title": "按状态码统计检查速率（5分钟） / Check Rate by Status Code (5m)",
      "type": "timeseries",
      "description": "按任务与状态码分组的检查速率 / Check rate grouped by task and status code."
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "x": 0,
        "y": 52,
        "w": 24,
        "h": 8
      },
      "id": 9,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sort_desc(time() - timestamp(url_check_http_status_code{task_name=~\"$task\"}))",
          "legendFormat": "{{task_name}}",
          "refId": "A"
        }
      ],
      "title": "数据新鲜度（秒） / Data Freshness (s)",
      "type": "timeseries",
      "description": "当前时刻到该任务最近一次指标更新时间的间隔 / Seconds since last metric update per task."
    }
  ],
  "refresh": "15s",
  "schemaVersion": 39,
  "style": "dark",
  "tags": [
    "url-check",
    "prometheus",
    "中文",
    "增强版",
    "enhanced"
  ],
  "templating": {
    "list": [
      {
        "name": "task",
        "label": "任务 / Task",
        "type": "query",
        "datasource": {
          "type": "prometheus",
          "uid": "prometheus"
        },
        "definition": "label_values(url_check_http_status_code, task_name)",
        "query": {
          "query": "label_values(url_check_http_status_code, task_name)",
          "refId": "PrometheusVariableQueryEditor-Task"
        },
        "includeAll": true,
        "multi": true,
        "allValue": ".*",
        "current": {
          "selected": true,
          "text": [
            "All"
          ],
          "value": [
            "$__all"
          ]
        },
        "refresh": 2,
        "sort": 1
      }
    ]
  },
  "time": {
    "from": "now-30m",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "URL 检查监控总览 / URL Check Monitoring Overview (Enhanced)",
  "uid": "url-check-basic",
  "version": 4,
  "weekStart": ""
}
